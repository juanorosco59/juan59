<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f4f7f6;
        gap: 20px;
      }

      .sap-button {
        background-color: #0854a0;
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <!-- ===================================================== -->
    <!-- BOTÃ“N EXISTENTE - NO MODIFICAR                        -->
    <!-- ===================================================== -->
    <button class="sap-button" onclick="launchNavigation()">
      Test 3.0 IOs
    </button>

    <!-- ===================================================== -->
    <!-- NUEVO BOTÃ“N - ABRIR PDF (USANDO BLOB)                 -->
    <!-- ===================================================== -->
    <button class="sap-button" onclick="openPdfWithBlob()">
      Abrir PDF 1.0
    </button>

    <script>
      /* ===================================================== */
      /* FUNCIÃ“N EXISTENTE - NO MODIFICAR                      */
      /* ===================================================== */
      function launchNavigation() {
        const urlParams = new URLSearchParams(window.location.search);
        const idVisita = urlParams.get("idVisita") || "Sin_IdVisita";

        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const dispositivoTag = isMobile
          ? "Celular_iOS_Android"
          : "Escritorio";

        const queryText = `${idVisita} (Deteccion: ${dispositivoTag})`;
        const urlDestino =
          "https://www.google.com/search?q=" +
          encodeURIComponent(queryText);

        try {
          if (isMobile && window.top && window.top !== window) {
            window.top.location.href = urlDestino;
          } else {
            const newWin = window.open(urlDestino, "_blank");
            if (!newWin) {
              window.location.assign(urlDestino);
            }
          }
        } catch (e) {
          window.location.assign(urlDestino);
        }
      }

      /* ===================================================== */
      /* NUEVA FUNCIÃ“N - ABRIR PDF USANDO BLOB                 */
      /* ===================================================== */
      async function openPdfWithBlob() {
        try {
          // ðŸ‘‰ PDF CUALQUIERA (local o remoto)
          const pdfUrl = "archivo.pdf"; // CAMBIA SOLO ESTA RUTA

          // Obtener el PDF como Blob
          const response = await fetch(pdfUrl);
          if (!response.ok) {
            throw new Error("No se pudo obtener el PDF");
          }

          const blob = await response.blob();

          // Crear URL temporal del Blob
          const url = window.URL.createObjectURL(blob);

          // Abrir PDF en ventana emergente
          const popupWindow = window.open(
            url,
            "_blank",
            "width=800,height=600,scrollbars=yes,resizable=yes"
          );

          // Liberar el objeto URL despuÃ©s de usarlo
          setTimeout(() => {
            window.URL.revokeObjectURL(url);
          }, 1000);
        } catch (error) {
          console.error("Error al abrir el PDF:", error);
          alert("No se pudo abrir el PDF");
        }
      }
    </script>
  </body>
</html>

